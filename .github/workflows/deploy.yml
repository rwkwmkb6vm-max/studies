name: IOS-XR GitOps Demo

on:
  push:
    paths:
      - "playbooks/**"
      - "inventory/**"
      - ".github/workflows/**"

jobs:
  deploy:
    runs-on: self-hosted
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use venv python if present
        run: |
          python3 --version
          pip --version

      - name: Setup Python deps (no pip drama)
        shell: bash
        run: |
          python3 --version

          # pip yoksa yükle (macOS / python3.13 için güvenli)
          python3 -m ensurepip --upgrade || true

          # pip'i upgrade et
          python3 -m pip install --upgrade pip setuptools wheel

          # ansible ve collection
          python3 -m pip install "ansible>=10,<11"
          ansible-galaxy collection install cisco.iosxr --force


      - name: Run playbook
        env:
          XR_USERNAME: ${{ secrets.XR_USERNAME }}
          XR_PASSWORD: ${{ secrets.XR_PASSWORD }}
        run: |
          ansible-playbook -i inventory/hosts.yml playbooks/isis.yml


